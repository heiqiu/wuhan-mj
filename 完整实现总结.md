# 武汉红中赖子杠拆搭训练系统 - 完整实现总结

## 📋 项目概览

本项目是一个完全基于前端JavaScript实现的武汉麻将拆搭训练系统，严格遵循武汉红中赖子杠（开口翻）的真实规则。

## 🎯 版本历史

### v1.0 (初始版本)
- ✅ 基础拆搭训练功能
- ✅ 简单的牌效评估算法
- ✅ 评分系统
- ✅ 历史记录

### v1.1 (2026-01-10)
- ✅ PNG图片显示麻将牌
- ✅ 红中杠牌功能（杠后摸牌）
- ✅ 手牌整理功能（摸牌集成）

### v2.0 (2026-01-10) ⭐ 当前版本
- ✅ **完整实现武汉红中赖子杠规则**
- ✅ 规则驱动的架构设计
- ✅ 上下文感知的分析算法
- ✅ 多维度评估体系
- ✅ 实时规则检查提示

## 🏗️ 系统架构

```
training/
├── assets/
│   └── tiles/          # 34张PNG麻将牌图片
├── css/
│   └── main.css        # 样式文件（600+行）
├── js/
│   ├── core/           # 核心算法模块
│   │   ├── TileConstants.js    # 常量定义
│   │   ├── MajiangRules.js     # ⭐ 规则引擎（新增）
│   │   ├── TileUtils.js        # 工具方法
│   │   ├── TileGenerator.js    # 牌型生成
│   │   ├── TileAnalyzer.js     # ⭐ 牌型分析（重构）
│   │   └── ScoringSystem.js    # 评分系统
│   ├── state/          # 状态管理
│   │   └── GameState.js        # ⭐ 游戏状态（增强）
│   ├── ui/             # UI组件
│   │   ├── TileDisplay.js      # 牌面显示
│   │   ├── AnalysisPanel.js    # ⭐ 分析面板（增强）
│   │   └── HistoryPanel.js     # 历史记录
│   ├── storage/        # 数据持久化
│   │   └── StorageManager.js   # 本地存储
│   └── app.js          # 主应用
├── index.html          # 主页面
├── rule-test.html      # ⭐ 规则测试页面（新增）
├── test.html           # 算法测试页面
└── 更新说明_v2.0.md    # ⭐ 详细更新文档（新增）
```

## 🎮 核心功能

### 1. 完整的武汉麻将规则

#### 红中规则
```javascript
{
  CAN_GANG: true,           // 可以随时杠牌
  DISCARD_IS_GANG: true,    // 打出也算杠牌
  CANNOT_PENG: true,        // 不能碰
  CANNOT_MINGGANG: true,    // 不能明杠
  CANNOT_ANGANG: true,      // 不能暗杠
  HOLD_CANNOT_HU: true,     // 持有不能胡牌
  GANG_FANSHU: 1            // 红中杠1番
}
```

#### 赖子规则
```javascript
{
  IS_WILDCARD: true,        // 可作万能牌
  SOFT_HU_MULTIPLY: 1,      // 软胡×1
  HARD_HU_MULTIPLY: 2,      // 硬胡×2
  CAN_SINGLE_GANG: true,    // 可单张杠出
  GANG_FANSHU: 2,           // 赖子杠2番
  TWO_LAIZI_NO_XIAOHU: true,// 两个赖子不能胡小胡
  CANNOT_USE_FOR_CHI_PENG: true // 不能用来吃碰杠
}
```

#### 将牌规则
- 小胡必须用2、5、8做将牌
- 碰碰胡、清一色、将一色、风一色不受限制

#### 杠牌规则
- **冲杠(直杠)**: 1番，×2，不能抢杠
- **蓄杠**: 1番，×2，可以抢杠
- **暗杠**: 2番，×4，不能抢杠

#### 胡牌类型
**小胡**: 基础分1
**大胡**: 基础分10（可累计）
- 碰碰胡
- 清一色
- 将一色
- 风一色
- 全求人
- 杠上花（杠开）
- 海底捞
- 抢杠

### 2. 智能分析系统

#### 打牌优先级
1. **红中** → -1000分（最高优先级打出）
2. **多余赖子** → -800分（两个赖子不能胡小胡）
3. **孤张** → -50分
4. **边张** → -20分
5. **风牌单张** → -30分

#### 保留优先级
1. **刻子** → +50分
2. **对子** → +30分
3. **258将牌** → +15分
4. **中张** → +25分
5. **搭子潜力** → +30分/搭

#### 评估维度
```javascript
- 牌效价值（搭子潜力、进张数）
- 规则约束（红中、赖子、开口）
- 将牌优先级（258加权）
- 手牌整体质量（0-100分）
```

### 3. 实时规则检查

训练过程中，系统会实时检查并提示：
- ⚠️ **红中提醒**: 持有红中不能胡牌，必须打出
- ⚠️ **赖子提醒**: 两个赖子不能胡小胡，建议打掉一张
- ℹ️ **赖子提醒**: 一张赖子可作万能牌（软胡×1）或硬胡（×2）
- ℹ️ **开口提醒**: 尚未开口，需要吃、碰或杠才能胡牌
- ✅ **开口确认**: 已开口，可以胡牌

### 4. 番数计算系统

#### 计算公式
```
番数 = 基础分 
     × 开口倍数（2^开口次数）
     + 杠牌番数（红中杠+1，赖子杠+2）
     × 暗杠倍数（4^暗杠次数）
     × 明杠倍数（2^明杠次数）
     × 硬胡倍数（×2）
     × 自摸倍数（小胡×2，大胡×1.5）
     × 放冲倍数（×2）
```

#### 计算示例

**场景1: 小胡+开口1次+自摸**
```
基础分1 × 开口×2 × 自摸×2 = 4番
```

**场景2: 硬胡+开口1次+红中杠+自摸**
```
(基础分1 + 红中杠1番) × 开口×2 × 硬胡×2 × 自摸×2 = 16番
```

**场景3: 大胡(碰碰胡+清一色)+暗杠+硬胡+开口3次+自摸**
```
基础分20 × 开口×2³ × 暗杠×4 × 硬胡×2 × 自摸×1.5 = 3840番
```

## 🧪 测试页面

### `rule-test.html` - 规则测试页面

提供6个交互式测试场景：
1. **红中规则测试** - 持有检测、杠牌逻辑、打牌分析
2. **赖子规则测试** - 万能牌、两赖子限制、打牌分析
3. **258将牌规则测试** - 各牌判断、大胡例外
4. **开口规则测试** - 未开口/已开口状态检查
5. **番数计算测试** - 三种复杂场景的番数计算
6. **完整场景测试** - 综合测试红中+赖子+规则检查

### 使用方法
```bash
# 方式1: 直接双击打开
rule-test.html

# 方式2: 启动本地服务器
cd training
python -m http.server 8000
# 访问 http://localhost:8000/rule-test.html
```

## 📊 代码统计

| 文件 | 行数 | 说明 |
|-----|-----|-----|
| MajiangRules.js | 182 | 规则引擎（新增） |
| TileAnalyzer.js | 431 | 牌型分析器（+145行） |
| AnalysisPanel.js | 198 | 分析面板（+70行） |
| GameState.js | 262 | 游戏状态（+10行） |
| rule-test.html | 343 | 规则测试页面（新增） |
| **总计** | **1416+** | **v2.0新增/修改代码** |

## 🚀 快速开始

### 1. 打开训练系统
```bash
# Windows
启动服务器.bat

# 或双击
index.html
```

### 2. 开始训练
1. 点击"🎲 开始新轮"生成随机牌型
2. 观察手牌，分析牌型
3. 如果有红中，会提示"必须打出"
4. 如果有多个赖子，会提示"两个赖子不能胡小胡"
5. 点击要打出的牌
6. 查看分析结果和规则提示
7. 点击"下一轮"继续训练

### 3. 测试规则
```bash
# 打开规则测试页面
rule-test.html

# 点击各个测试按钮
- 红中规则测试
- 赖子规则测试
- 258将牌测试
- 开口规则测试
- 番数计算测试
- 完整场景测试
```

## 🎓 规则学习建议

### 初学者
1. 先熟悉**红中规则**: 持有红中不能胡牌
2. 理解**开口概念**: 必须吃/碰/杠才能胡牌
3. 记住**258将牌**: 小胡必须用2、5、8做将

### 进阶玩家
1. 学习**赖子使用**: 软胡vs硬胡的取舍
2. 掌握**番数计算**: 开口、杠牌、硬胡的倍数叠加
3. 理解**大胡类型**: 碰碰胡、清一色等的识别

### 高级玩家
1. 研究**拆搭技巧**: 保留搭子、拆小不拆大
2. 分析**听牌效率**: 多面听、单吊
3. 实战**安全打法**: 避免放炮、控制节奏

## 🔮 未来计划

### v2.1 (计划中)
- [ ] 实现赖子翻牌逻辑
- [ ] 添加吃/碰/杠操作UI
- [ ] 自动追踪开口状态
- [ ] 赖子场景专项训练

### v2.2 (计划中)
- [ ] 完整的听牌检测算法
- [ ] 多种胡牌类型自动识别
- [ ] 番数详细计算显示
- [ ] 大胡牌型识别训练

### v3.0 (远期)
- [ ] 多人对局模拟
- [ ] AI对手系统
- [ ] 实战录像回放
- [ ] 排行榜与成就系统

## 💡 技术亮点

### 1. 规则驱动的架构
- 规则集中管理，易于维护
- 规则修改不影响算法
- 支持规则版本切换

### 2. 上下文感知的算法
- 实时考虑游戏状态
- 规则约束优先级最高
- 动态调整评估策略

### 3. 多维度评估体系
```
评估分数 = 基础价值
         + 规则调整（-1000 ~ +100）
         + 牌型潜力（0 ~ +150）
         + 特殊加权（258将+15）
```

### 4. 实时反馈系统
- 规则检查实时显示
- 打牌原因详细解释
- 备选方案完整展示

## 📚 相关文档

- [更新说明_v1.1.md](更新说明_v1.1.md) - v1.1版本更新详情
- [更新说明_v2.0.md](更新说明_v2.0.md) - v2.0版本完整文档
- [README.md](README.md) - 项目说明
- [快速入门.md](快速入门.md) - 快速入门指南
- [项目说明.md](项目说明.md) - 详细项目文档

## 📄 许可
本项目为学习和训练工具，遵循MIT许可证。

## 🤝 贡献
欢迎提交Issue和Pull Request！

## 📧 反馈
如有问题或建议，请在项目中提出。

---

**最后更新**: 2026-01-10  
**当前版本**: v2.0  
**开发者**: AI Assistant
