<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è§„åˆ™æµ‹è¯• - æ­¦æ±‰çº¢ä¸­èµ–å­æ </title>
  <style>
    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c5f2d;
      border-bottom: 3px solid #97ce4c;
      padding-bottom: 10px;
    }
    h2 {
      color: #555;
      margin-top: 0;
    }
    .result {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      background: #f8f9fa;
    }
    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 10px;
    }
    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 10px;
    }
    .info {
      background: #d1ecf1;
      border-left: 4px solid #17a2b8;
      padding: 10px;
    }
    button {
      background: #2c5f2d;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #97ce4c;
    }
    .code {
      background: #f4f4f4;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ¯ æ­¦æ±‰çº¢ä¸­èµ–å­æ  - è§„åˆ™ç³»ç»Ÿæµ‹è¯•</h1>

  <div class="test-section">
    <h2>1. çº¢ä¸­è§„åˆ™æµ‹è¯•</h2>
    <button onclick="testZhongRule()">æµ‹è¯•çº¢ä¸­è§„åˆ™</button>
    <div id="zhong-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>2. èµ–å­è§„åˆ™æµ‹è¯•</h2>
    <button onclick="testLaiziRule()">æµ‹è¯•èµ–å­è§„åˆ™</button>
    <div id="laizi-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>3. 258å°†ç‰Œè§„åˆ™æµ‹è¯•</h2>
    <button onclick="test258Jiang()">æµ‹è¯•258å°†ç‰Œ</button>
    <div id="jiang-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>4. å¼€å£è§„åˆ™æµ‹è¯•</h2>
    <button onclick="testOpenRule()">æµ‹è¯•å¼€å£è§„åˆ™</button>
    <div id="open-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>5. ç•ªæ•°è®¡ç®—æµ‹è¯•</h2>
    <button onclick="testFanshuCalculation()">æµ‹è¯•ç•ªæ•°è®¡ç®—</button>
    <div id="fanshu-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>6. å®Œæ•´åœºæ™¯æµ‹è¯•</h2>
    <button onclick="testFullScenario()">æµ‹è¯•å®Œæ•´åœºæ™¯</button>
    <div id="full-result" class="result"></div>
  </div>

  <!-- å¼•å…¥æ‰€æœ‰JSæ–‡ä»¶ -->
  <script src="js/core/TileConstants.js"></script>
  <script src="js/core/MajiangRules.js"></script>
  <script src="js/core/TileUtils.js"></script>
  <script src="js/core/TileGenerator.js"></script>
  <script src="js/core/TileAnalyzer.js"></script>
  <script src="js/core/ScoringSystem.js"></script>

  <script>
    // æµ‹è¯•1ï¼šçº¢ä¸­è§„åˆ™
    function testZhongRule() {
      const result = document.getElementById('zhong-result');
      result.innerHTML = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';

      // æµ‹è¯•1.1ï¼šæ£€æŸ¥æ˜¯å¦æŒæœ‰çº¢ä¸­
      const handWithZhong = ['wan1', 'wan2', 'wan3', 'zhong', 'tiao5'];
      const hasZhong = MajiangRules.hasZhong(handWithZhong);
      result.innerHTML += `<div class="${hasZhong ? 'warning' : 'success'}">
        æŒæœ‰çº¢ä¸­æ£€æŸ¥: ${hasZhong ? 'âœ… æ£€æµ‹åˆ°çº¢ä¸­' : 'âŒ æœªæ£€æµ‹åˆ°'}
      </div>`;

      // æµ‹è¯•1.2ï¼šçº¢ä¸­è§„åˆ™é…ç½®
      const zhongRules = MajiangRules.RULES.ZHONG_RULES;
      result.innerHTML += `<div class="info">
        <strong>çº¢ä¸­è§„åˆ™é…ç½®ï¼š</strong><br>
        - å¯ä»¥æ ç‰Œ: ${zhongRules.CAN_GANG ? 'âœ…' : 'âŒ'}<br>
        - æ‰“å‡ºç®—æ : ${zhongRules.DISCARD_IS_GANG ? 'âœ…' : 'âŒ'}<br>
        - æŒæœ‰ä¸èƒ½èƒ¡: ${zhongRules.HOLD_CANNOT_HU ? 'âœ…' : 'âŒ'}<br>
        - æ ç‰Œç•ªæ•°: ${zhongRules.GANG_FANSHU}ç•ª
      </div>`;

      // æµ‹è¯•1.3ï¼šæ‰“ç‰Œåˆ†æï¼ˆæœ‰çº¢ä¸­ï¼‰
      const analyzer = new TileAnalyzer();
      const analysis = analyzer.findBestDiscard(handWithZhong, { hasOpened: false, laiziTile: null });
      result.innerHTML += `<div class="${analysis.bestDiscard === 'zhong' ? 'success' : 'warning'}">
        <strong>æ‰“ç‰Œåˆ†æï¼š</strong><br>
        æœ€ä½³æ‰“ç‰Œ: <strong>${TileUtils.getTileText(analysis.bestDiscard)}</strong><br>
        åŸå› : ${analysis.reason}
      </div>`;
    }

    // æµ‹è¯•2ï¼šèµ–å­è§„åˆ™
    function testLaiziRule() {
      const result = document.getElementById('laizi-result');
      result.innerHTML = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';

      // æµ‹è¯•2.1ï¼šèµ–å­è§„åˆ™é…ç½®
      const laiziRules = MajiangRules.RULES.LAIZI_RULES;
      result.innerHTML += `<div class="info">
        <strong>èµ–å­è§„åˆ™é…ç½®ï¼š</strong><br>
        - å¯ä½œä¸‡èƒ½ç‰Œ: ${laiziRules.IS_WILDCARD ? 'âœ…' : 'âŒ'}<br>
        - è½¯èƒ¡å€æ•°: Ã—${laiziRules.SOFT_HU_MULTIPLY}<br>
        - ç¡¬èƒ¡å€æ•°: Ã—${laiziRules.HARD_HU_MULTIPLY}<br>
        - å¯å•å¼ æ : ${laiziRules.CAN_SINGLE_GANG ? 'âœ…' : 'âŒ'}<br>
        - èµ–å­æ ç•ªæ•°: ${laiziRules.GANG_FANSHU}ç•ª<br>
        - ä¸¤èµ–å­ä¸èƒ½èƒ¡å°èƒ¡: ${laiziRules.TWO_LAIZI_NO_XIAOHU ? 'âœ…' : 'âŒ'}
      </div>`;

      // æµ‹è¯•2.2ï¼šä¸¤ä¸ªèµ–å­
      const handWithTwoLaizi = ['wan1', 'wan2', 'wan3', 'tong5', 'tong5', 'tiao7', 'tiao8'];
      const laiziCount = MajiangRules.countLaizi(handWithTwoLaizi, 'tong5');
      result.innerHTML += `<div class="warning">
        <strong>èµ–å­æ•°é‡æ£€æŸ¥ï¼š</strong><br>
        æ‰‹ç‰Œ: ${handWithTwoLaizi.map(t => TileUtils.getTileText(t)).join(' ')}<br>
        èµ–å­(äº”ç­’)æ•°é‡: ${laiziCount}å¼ <br>
        ${laiziCount >= 2 ? 'âš ï¸ ä¸¤ä¸ªèµ–å­ä¸èƒ½èƒ¡å°èƒ¡ï¼Œå¿…é¡»æ‰“æ‰ä¸€å¼ ' : 'âœ… èµ–å­æ•°é‡æ­£å¸¸'}
      </div>`;

      // æµ‹è¯•2.3ï¼šæ‰“ç‰Œåˆ†æï¼ˆæœ‰ä¸¤ä¸ªèµ–å­ï¼‰
      const analyzer = new TileAnalyzer();
      const analysis = analyzer.findBestDiscard(handWithTwoLaizi, { hasOpened: false, laiziTile: 'tong5' });
      result.innerHTML += `<div class="success">
        <strong>æ‰“ç‰Œåˆ†æï¼š</strong><br>
        æœ€ä½³æ‰“ç‰Œ: <strong>${TileUtils.getTileText(analysis.bestDiscard)}</strong><br>
        åŸå› : ${analysis.reason}
      </div>`;
    }

    // æµ‹è¯•3ï¼š258å°†ç‰Œè§„åˆ™
    function test258Jiang() {
      const result = document.getElementById('jiang-result');
      result.innerHTML = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';

      // æµ‹è¯•æ‰€æœ‰ç‰Œçš„å°†ç‰Œåˆ¤æ–­
      const testTiles = ['wan2', 'wan5', 'wan8', 'tong3', 'tiao7', 'dong', 'zhong'];
      result.innerHTML += '<div class="info"><strong>258å°†ç‰Œæ£€æŸ¥ï¼š</strong><br>';
      testTiles.forEach(tile => {
        const is258 = MajiangRules.is258Jiang(tile);
        const canBe = MajiangRules.canBeJiang(tile, 'XIAOHU');
        result.innerHTML += `${TileUtils.getTileText(tile)}: ${is258 ? 'âœ… æ˜¯258' : 'âŒ ä¸æ˜¯258'} - ${canBe ? 'å¯ä½œå°†ç‰Œ' : 'ä¸å¯ä½œå°†ç‰Œ'}<br>`;
      });
      result.innerHTML += '</div>';

      // æµ‹è¯•å¤§èƒ¡ä¾‹å¤–
      result.innerHTML += `<div class="success">
        <strong>å¤§èƒ¡ä¾‹å¤–è§„åˆ™ï¼š</strong><br>
        ç¢°ç¢°èƒ¡ã€æ¸…ä¸€è‰²ã€å°†ä¸€è‰²ã€é£ä¸€è‰²ä¸å—258å°†ç‰Œé™åˆ¶
      </div>`;
    }

    // æµ‹è¯•4ï¼šå¼€å£è§„åˆ™
    function testOpenRule() {
      const result = document.getElementById('open-result');
      result.innerHTML = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';

      const hand = ['wan1', 'wan2', 'wan3', 'tong5', 'tong6', 'tiao7'];
      
      // æµ‹è¯•æœªå¼€å£
      const checkNotOpened = MajiangRules.canHu(hand, null, false);
      result.innerHTML += `<div class="${checkNotOpened.canHu ? 'success' : 'warning'}">
        <strong>æœªå¼€å£çŠ¶æ€ï¼š</strong><br>
        å¯ä»¥èƒ¡ç‰Œ: ${checkNotOpened.canHu ? 'âœ…' : 'âŒ'}<br>
        ${checkNotOpened.checks.map(c => `- ${c.reason}`).join('<br>')}
      </div>`;

      // æµ‹è¯•å·²å¼€å£
      const checkOpened = MajiangRules.canHu(hand, null, true);
      result.innerHTML += `<div class="${checkOpened.canHu ? 'success' : 'warning'}">
        <strong>å·²å¼€å£çŠ¶æ€ï¼š</strong><br>
        å¯ä»¥èƒ¡ç‰Œ: ${checkOpened.canHu ? 'âœ…' : 'âŒ'}<br>
        ${checkOpened.checks.map(c => `- ${c.reason}`).join('<br>')}
      </div>`;
    }

    // æµ‹è¯•5ï¼šç•ªæ•°è®¡ç®—
    function testFanshuCalculation() {
      const result = document.getElementById('fanshu-result');
      result.innerHTML = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';

      // åœºæ™¯1ï¼šå°èƒ¡ï¼Œå¼€å£ä¸€æ¬¡ï¼Œè‡ªæ‘¸
      const score1 = MajiangRules.calculateFanshu({
        baseScore: 1,
        openCount: 1,
        zhongGang: 0,
        laiziGang: 0,
        anGang: 0,
        mingGang: 0,
        isHardHu: false,
        isZimo: true,
        isDahu: false
      });
      result.innerHTML += `<div class="info">
        <strong>åœºæ™¯1ï¼šå°èƒ¡+å¼€å£1æ¬¡+è‡ªæ‘¸</strong><br>
        åŸºç¡€åˆ†1 Ã— å¼€å£Ã—2 Ã— è‡ªæ‘¸Ã—2 = ${score1}ç•ª
      </div>`;

      // åœºæ™¯2ï¼šç¡¬èƒ¡ï¼Œå¼€å£ä¸€æ¬¡ï¼Œæ çº¢ä¸­ä¸€æ¬¡ï¼Œè‡ªæ‘¸
      const score2 = MajiangRules.calculateFanshu({
        baseScore: 1,
        openCount: 1,
        zhongGang: 1,
        laiziGang: 0,
        anGang: 0,
        mingGang: 0,
        isHardHu: true,
        isZimo: true,
        isDahu: false
      });
      result.innerHTML += `<div class="success">
        <strong>åœºæ™¯2ï¼šç¡¬èƒ¡+å¼€å£1æ¬¡+çº¢ä¸­æ +è‡ªæ‘¸</strong><br>
        (åŸºç¡€åˆ†1 + çº¢ä¸­æ 1ç•ª) Ã— å¼€å£Ã—2 Ã— ç¡¬èƒ¡Ã—2 Ã— è‡ªæ‘¸Ã—2 = ${score2}ç•ª
      </div>`;

      // åœºæ™¯3ï¼šå¤§èƒ¡ï¼Œç¢°ç¢°èƒ¡+æ¸…ä¸€è‰²ï¼Œç¡¬èƒ¡ï¼Œæš—æ ä¸€æ¬¡ï¼Œè‡ªæ‘¸
      const score3 = MajiangRules.calculateFanshu({
        baseScore: 20, // ä¸¤ä¸ªå¤§èƒ¡
        openCount: 3,
        zhongGang: 0,
        laiziGang: 0,
        anGang: 1,
        mingGang: 0,
        isHardHu: true,
        isZimo: true,
        isDahu: true
      });
      result.innerHTML += `<div class="warning">
        <strong>åœºæ™¯3ï¼šå¤§èƒ¡(ç¢°ç¢°èƒ¡+æ¸…ä¸€è‰²)+æš—æ +ç¡¬èƒ¡+å¼€å£3æ¬¡+è‡ªæ‘¸</strong><br>
        åŸºç¡€åˆ†20 Ã— å¼€å£Ã—2Â³ Ã— æš—æ Ã—4 Ã— ç¡¬èƒ¡Ã—2 Ã— è‡ªæ‘¸Ã—1.5 = ${score3}ç•ª
      </div>`;
    }

    // æµ‹è¯•6ï¼šå®Œæ•´åœºæ™¯
    function testFullScenario() {
      const result = document.getElementById('full-result');
      result.innerHTML = '<h3>å®Œæ•´åœºæ™¯æµ‹è¯•ï¼š</h3>';

      // åœºæ™¯ï¼šæ‰‹ç‰Œä¸­æœ‰çº¢ä¸­å’Œä¸€ä¸ªèµ–å­
      const hand = ['wan1', 'wan2', 'wan3', 'zhong', 'tong5', 'tong6', 'tong6', 'tiao7', 'tiao8', 'dong', 'dong', 'dong', 'bei', 'bei'];
      const laiziTile = 'tong6';

      result.innerHTML += `<div class="code">
        <strong>æ‰‹ç‰Œï¼š</strong>${hand.map(t => TileUtils.getTileText(t)).join(' ')}<br>
        <strong>èµ–å­ï¼š</strong>${TileUtils.getTileText(laiziTile)}
      </div>`;

      // æ‰§è¡Œåˆ†æ
      const analyzer = new TileAnalyzer();
      const analysis = analyzer.findBestDiscard(hand, { hasOpened: false, laiziTile });

      // æ˜¾ç¤ºè§„åˆ™æ£€æŸ¥
      if (analysis.ruleChecks && analysis.ruleChecks.length > 0) {
        result.innerHTML += '<div class="info"><strong>è§„åˆ™æ£€æŸ¥ï¼š</strong><br>';
        analysis.ruleChecks.forEach(check => {
          const emoji = check.type === 'warning' ? 'âš ï¸' : (check.type === 'success' ? 'âœ…' : 'â„¹ï¸');
          result.innerHTML += `${emoji} <strong>${check.rule}:</strong> ${check.message}<br>`;
        });
        result.innerHTML += '</div>';
      }

      // æ˜¾ç¤ºæœ€ä½³æ‰“æ³•
      result.innerHTML += `<div class="success">
        <strong>æœ€ä½³æ‰“æ³•ï¼š</strong>${TileUtils.getTileText(analysis.bestDiscard)}<br>
        <strong>åŸå› ï¼š</strong>${analysis.reason}
      </div>`;

      // æ˜¾ç¤ºå¤‡é€‰æ–¹æ¡ˆ
      result.innerHTML += '<div class="info"><strong>å¤‡é€‰æ–¹æ¡ˆï¼ˆå‰5ä¸ªï¼‰ï¼š</strong><br>';
      analysis.alternatives.slice(0, 5).forEach((alt, i) => {
        result.innerHTML += `${i+1}. ${TileUtils.getTileText(alt.tile)} (è¯„åˆ†: ${alt.score.toFixed(1)})<br>`;
      });
      result.innerHTML += '</div>';
    }

    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
    window.onload = function() {
      console.log('ğŸ¯ æ­¦æ±‰çº¢ä¸­èµ–å­æ è§„åˆ™ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
      console.log('ç‚¹å‡»å„ä¸ªæµ‹è¯•æŒ‰é’®æŸ¥çœ‹è§„åˆ™å®ç°æ•ˆæœ');
    };
  </script>
</body>
</html>
